{% extends "base.html" %}


{% block content %}
<header class="mb-2">
    <h1>Settings</h1>
    <p class="text-muted">Manage your account and connections</p>
</header>

<div>
    <!-- SimpleFin Status -->
    <div class="card">
        <h2>Bank Connection</h2>
        <div id="status-box" class="flex align-center mt-2 mb-2 box-item">
            <div id="status-dot" class="status-dot"></div>
            <span id="status-text">Checking...</span>
        </div>

        <div id="connect-form" style="display: none;">
            <p class="text-muted mb-2">Enter your SimpleFin Access Key. It will be encrypted securely.</p>
            <div class="form-group">
                <input type="password" id="simplefin-key" placeholder="Paste Access Key or Setup Token">
            </div>
            <button class="btn btn-primary" onclick="connect()">Connect</button>
        </div>

        <div id="manage-form" style="display: none;">
            <div class="flex">
                <button class="btn btn-primary" id="sync-btn" onclick="syncBank()">Sync Now</button>
                <button class="btn btn-danger" onclick="disconnect()">Disconnect</button>
            </div>
            <div id="sync-result" class="mt-2" style="display: none;"></div>
        </div>
    </div>
    <!-- Category Management -->
    <div class="card mt-2">
        <h2>Manage Categories</h2>
        <p class="text-muted mb-2">
            Edit or remove your categories. Renaming will update all historic transactions.
        </p>

        <!-- Category Dropdown + Actions -->
        <div class="flex align-center mb-2 box-item-actions">
            <div class="form-group" style="flex-grow: 1; margin-bottom: 0;">
                <select id="manage-category-select" onchange="updateManageButtons()" class="w-100"></select>
            </div>
            <button class="btn btn-secondary" onclick="renameCurrent()">Rename</button>
            <button class="btn btn-danger" id="delete-current-btn" onclick="deleteCurrent()">Delete</button>
        </div>

        <!-- Add Category -->
        <div class="flex mt-2" style="padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
            <div class="form-group" style="flex-grow: 1; margin-bottom: 0;">
                <input type="text" id="new-cat-name" placeholder="New category name (e.g. Travel)">
            </div>
            <button class="btn btn-primary" onclick="addCategory()">Add New</button>
        </div>
    </div>
    <!-- Account Management -->
    <div class="card mb-2">
        <h2>Accounts</h2>
        <p class="text-muted mb-2">Manage your connected and manual accounts.</p>

        <div id="accounts-list" class="mb-3">
            <!-- Accounts will be loaded here -->
            <p class="text-muted">Loading accounts...</p>
        </div>

        <h3>Add Manual Account</h3>
        <div class="flex mt-2">
            <div class="form-group" style="margin-bottom: 0;">
                <input type="text" id="new-account-name" placeholder="Name (e.g. Cash, Wallet)">
            </div>
            <div class="form-group" style="margin-bottom: 0; width: 100px;">
                <input type="number" id="new-account-balance" placeholder="Balance" step="0.01">
            </div>
            <div class="form-group" style="margin-bottom: 0; width: 120px;">
                <select id="new-account-type">
                    <option value="checking">Checking</option>
                    <option value="savings">Savings</option>
                    <option value="credit">Credit Card</option>
                    <option value="cash">Cash</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="addAccount()">Add</button>
        </div>
    </div>

    <!-- Data Management -->
    <div class="card mt-2">
        <h2>Data Management</h2>
        <p class="text-muted mb-2">
            Download a copy of your transaction history.
        </p>
        <button class="btn btn-secondary" onclick="exportData()">
            <i class="fas fa-download"></i> Export to CSV
        </button>
    </div>


    {% endblock %}

    {% block scripts %}
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
    {% endblock %}